<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        {% load static %}
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="https://unpkg.com/@webpixels/css@1.1.5/dist/index.css">
        <!-- Font Awesome for icons -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
        <link rel="stylesheet" href="{% static 'css/style.css' %}" type="text/css">
        
        <style>
            /* Notification Bell Shake Animation */
            @keyframes shake {
                0% { transform: translateX(0) rotate(0); }
                10% { transform: translateX(-2px) rotate(-2deg); }
                20% { transform: translateX(2px) rotate(2deg); }
                30% { transform: translateX(-2px) rotate(-2deg); }
                40% { transform: translateX(2px) rotate(2deg); }
                50% { transform: translateX(0) rotate(0); }
            }
            .notification-bell-container.shake {
                animation: shake 0.7s ease-in-out;
            }

            .notification-bell-container {
                position: relative; 
            }
            .notification-badge {
                position: absolute;
                top: -8px; 
                right: -8px; 
                padding: 1.5px 4.5px;
                font-size: 0.625rem; 
                font-weight: 700;
                line-height: 1;
                color: #fff;
                text-align: center;
                white-space: nowrap;
                background-color: #d9534f; 
                border-radius: 50%;
                display: none; 
                border: 1px solid white; 
                box-shadow: 0 1px 2px rgba(0,0,0,0.2); 
                z-index: 1; /* Ensure badge is above bell icon */
            }

            /* --- Dropdown specific styling --- */
            .notifications-dropdown {
                /* Bootstrap's .dropdown-menu provides position: absolute; */
                /* .dropdown-menu-end aligns its right edge with the parent's right edge */
                min-width: 300px; /* Sensible minimum */
                max-width: 360px; /* A good max width for notifications */
                /* width: auto; /* Let content and min/max define it */
                max-height: 80vh; /* Max height to prevent very long lists */
                overflow-y: auto;
                font-size: 0.9rem; /* Base for dropdown text */
                color: #212529; 
                background-color: #ffffff; /* Ensure solid background */
                background-clip: padding-box;
                border: 1px solid #ced4da; /* Standard Bootstrap border color */
                border-radius: .375rem; 
                box-shadow: 0 .5rem 1rem rgba(0,0,0,.15); /* Standard shadow */
                margin-top: 0.3rem !important; 
                
                /* 
                KEY CHANGE FOR OVERFLOW:
                This transform is applied AFTER Bootstrap positions it with dropdown-menu-end.
                We shift it left by almost its entire width minus a bit for the bell icon's width.
                You may need to fine-tune '30px' or '40px'.
                */
                transform: translateX(calc(-100% + 40px)); /* Example: shift left by its width minus 40px */
                                                            /* If bell is ~30px wide, this leaves 10px of bell visible on the right of dropdown */

                /* Alternative if transform causes issues with sub-elements or is jittery:
                   If you remove 'dropdown-menu-end' from the <ul> tag, you can try:
                   right: 5px; /* Small offset from the very edge of the parent dropdown container 
                   left: auto;
                   This will align the right edge of the dropdown 5px from the right edge of its parent <li>
                */
            }


            .notification-item {
                padding: 0.7rem 1rem; 
                border-bottom: 1px solid #e9ecef; 
                white-space: normal; 
                word-wrap: break-word; 
            }
            .notification-item:last-child {
                border-bottom: none;
            }
            .notification-item:hover {
                background-color: #f8f9fa; 
            }
            .notification-item .btn-close {
                padding: 0.2rem 0.4rem; 
                margin-top: 1px; 
                opacity: 0.5;
            }
            .notification-item .btn-close:hover {
                opacity: 0.9;
            }
            .notification-reason {
                font-weight: 600; 
                color: #000; 
                font-size: 0.95em; /* Relative to dropdown's 0.9rem base */
                display: block; 
                margin-bottom: 0.2rem; 
                line-height: 1.3;
            }
            .notification-message {
                font-size: 0.9em; /* Relative to dropdown's 0.9rem base */
                color: #2a2a2a; /* Dark text for message */
                display: block; 
                line-height: 1.4; 
            }
            #noNotificationsMessageContainer { 
                 padding: 1rem 1rem;
                 text-align: center;
                 color: #555; 
                 font-size: 0.9em; 
            }
            .notifications-dropdown .dropdown-divider {
                margin: 0.5rem 0; 
                border-top: 1px solid #dee2e6; 
            }
            .notifications-dropdown .small-text-link a { 
                font-size: 0.9em; 
                padding: 0.6rem 1rem; 
            }
        </style>
        {% block stylesheets %}{% endblock stylesheets %}
        <title>IMS: {% block title %} {% endblock title %}</title>

        <link rel="icon" href="{% static 'images/logo/favicon.png' %}" type="image/png">
        
        <style>
            .paginator { display: flex; justify-content: center; }
            @media (max-width: 767.98px) {
                .navbar-brand { font-size: 18px !important; }
                .navbar .container-fluid { padding-left: 0.5rem; padding-right: 0.75rem; } 
            }
            @media (min-width: 768px) {
                .navbar .container-fluid {
                    padding-left: 1rem;
                    padding-right: 2rem; /* Decent padding from screen edge */
                }
            }
            @media (min-width: 992px) { #wrapper { margin-left: 250px; transition: margin-left 0.3s ease; } }
            @media (max-width: 991.98px) { #wrapper { margin-left: 0; transition: margin-left 0.3s ease; } }
        </style>
    </head>
    <body>
        {% include "store/sidebar.html" %} {# <<<< MAKE SURE TO FIX THE HOVER CSS IN THIS FILE #}
        <section id="wrapper">
            <nav class="navbar navbar-expand-md bg-success">
                <div class="container-fluid"> 
                  <div class="navbar-header d-flex align-items-center">
                    <button class="navbar-toggler me-2" type="button" data-bs-toggle="collapse" data-bs-target="#toggle-navbar" aria-controls="toggle-navbar" aria-expanded="false" aria-label="Toggle navigation">
                      <i class="fa fa-bars text-white"></i>
                    </button>
                    <a class="navbar-brand" style="font-size: 20px;" href="{% url 'dashboard' %}">GanaSales<span class="text-warning">Lite</span></a>
                  </div>
                  <div class="collapse navbar-collapse" id="toggle-navbar">
                    <div class="ms-auto d-flex align-items-center"> 
                        <ul class="navbar-nav align-items-center">
                          <!-- Notification Bell -->
                          {% if user.is_authenticated %}
                          <li class="nav-item dropdown">
                            <a class="nav-link notification-bell-container px-2 py-1" href="#" id="notificationBellDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"> 
                                <i class="fas fa-bell text-white fs-5"></i>
                                <span class="notification-badge" id="notificationBadge">0</span>
                            </a>
                            {# Keeping dropdown-menu-end, as transform is designed to work with it #}
                            <ul class="dropdown-menu dropdown-menu-end notifications-dropdown" aria-labelledby="notificationBellDropdown">
                                <div id="notificationList">
                                    <!-- Notifications will be injected here by JavaScript -->
                                </div>
                                <div id="noNotificationsMessageContainer">
                                   <span id="noNotificationsMessage" style="color: #ffffff;">No new notifications</span>
                                </div>
                                 <li><hr class="dropdown-divider"></li>
                                 {% comment %} <li class="small-text-link"><a class="dropdown-item text-center" href="{% url 'notifications:notify_settings_page' %}">Notification Settings</a></li> {% endcomment %}
                            </ul>
                          </li>
                          {% endif %}
                          <!-- End Notification Bell -->
                        </ul>
                    </div>
                  </div>
                </div>
              </nav>
          {% block content%}
          {% endblock content%}
        </section>
        
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        
        {% if user.is_authenticated %}
        <script src="{% static 'notifications/js/notifications.js' %}"></script>
        {% endif %}

        {% block javascripts %}{% endblock javascripts %}
      </body>
</html>